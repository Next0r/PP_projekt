@model BedAndBreakfast.Models.AnnouncementPaymentViewModel
@using BedAndBreakfast.Data;
@{
	ViewData["Title"] = "Payment";
	List<string> paymentMethods = Enum.GetNames(typeof(ListedDbValues.PaymentMethod)).ToList();

}

<h2>Payment</h2>


<script type="text/javascript">
	var rowCount = 0;
	var rows = [];
	var itemContainerName = "paymentMethods";

	function addItem() {
		$('#' + itemContainerName).append('<div id="row' + rowCount + '">' +
			'<select id="value' + rowCount + '" name="' + itemContainerName +'">' +
			'@foreach (string paymentMethod in paymentMethods) {<option>@paymentMethod</option>}' +
			'</select>' +
			'<input type="text" id="key' + rowCount + '" />' +
			'<input type="button" id="button' + rowCount + '" value="Remove" onclick="return removeItem(' + rowCount + ');" />' +
			'</div>');
		rows[rowCount] = true;
		rowCount++;
	}

	function removeItem(rowNumber) {
		$('#key' + rowNumber).remove();
		$('#value' + rowNumber).remove();
		$('#button' + rowNumber).remove();
		$('#row' + rowNumber).remove();
		rows[rowNumber] = false;
	}

	function sendToAction() {
		var count = 0;

		// Not that key is unique payment method e.g. bank account number.

		for (var i = 0; i < rows.length; i++) {
			if (rows[i] == true) {
				$('#form').append(
					'<input type="hidden" name="PaymentMethods[' + count + '].Key" value="' + $('#key' + i).val() + '"/>' +
					'<input type="hidden" name="PaymentMethods[' + count + '].Value" value="' + $('#value' + i).val() + '"/>');
				count++;
			}
		}
		// Add hidden form submit button and click it.
		$('#form').append('<input type="submit" id="submitButton" style="display: none;"/>');
		$('#submitButton').click();
	}
</script>


<div>
	<input type="button" value="Add payment method" onclick="return addItem();" />
</div>

@*Dummy container for generated fields.*@
<div id="paymentMethods"></div>
<div>
	<input type="button" value="Continue" onclick="return sendToAction();" />
</div>
@*Dummy container for generated form*@
<form asp-controller="Hosting" asp-action="SetAnnouncementPayment" id="form"></form>



